var fs = require('fs');

function File() {
  function getImageFile (document, cb) {
    var inputField = document.querySelector('#folderSelector');
    inputField.addEventListener('change', function () {
        var filePath = this.value;
        cb(filePath);
    }, false);
    inputField.click();
  }

  function writeImageToFile(image, document, cb) {
    var saveField = document.getElementById('save-image');
    saveField.addEventListener('change', function (e) {
      var filePath = this.value;

      fs.writeFile(filePath, image, 'base64', function (err) {
          if (err) cb(err, null);
          else cb(null, 'success');
      });

    }, false);
    saveField.click();
  }

  function getPointsFromFile (document, cb) {
    var inputField = document.querySelector('#import-points');
    inputField.addEventListener('change', function () {
        var filePath = this.value;

        fs.readFile(filePath, 'utf-8', function (error, contents) {
          if (error) {
            console.log(error);
            return;
          }
          cb(JSON.parse(contents));
        });
    }, false);
    inputField.click();
  }

  function writePointsToFile(points, document, cb) {
    var savePointsField = document.getElementById('save-points');
    console.log("Writing points to file...");

    savePointsField.addEventListener('change', function (e) {
      var filePath = this.value;

      fs.writeFile(filePath, points, function (err) {
        if (err) cb(err, null);
        else cb(null, 'success');
      });
    }, false);
    savePointsField.click();
  }
  
  this.getImageFile = getImageFile;
  this.writeImageToFile = writeImageToFile;
  this.getPointsFromFile = getPointsFromFile;
  this.writePointsToFile = writePointsToFile;
}


module.exports = new File;